# 智通校园-数据库需求说明

> 目的：说明本项目后端需要哪些“数据库模块”和“数据表”，以及统一的表命名/字段命名规范。
>
> 适用范围：对接当前前端小程序页面（`profile-edit`、`campus`、`resume`、`profile-*`）以及《后端模块与接口清单.md》里的接口（登录、用户资料、岗位、搜索、推荐、投递、积分、运营CMS、文件上传）。

---

## 1. 建议使用的数据库类型（不讲实现，只讲需要什么能力）

- **主业务数据库（必须）**：MySQL 8
  - 用来存用户、岗位、投递、企业、运营配置等“结构化数据”。
- **对象存储**：用来放简历文件本体（PDF/DOC/DOCX）
  - 数据库里只存“文件记录”（文件ID、URL、大小、类型等）。
- **搜索引擎**：用于岗位搜索更快
  - ES 的数据来源依然是主数据库（岗位表/企业表）。

---

## 2. 全局命名与范式规范（统一口径）

### 2.1 表命名规范
- **表名全部小写 + 下划线**：例如 `user_profile`
- **建议统一前缀**：`zt_`（表示“职通”）
  - 例：`zt_user`、`zt_job`
- **中间表命名**：`zt_<左表>_<右表>_rel`
  - 例：`zt_user_intended_city_rel`

### 2.2 字段命名规范
- **字段全部小写 + 下划线**：`created_at`、`company_id`
- **主键统一叫**：`id`
- **外键统一叫**：`xxx_id`
  - 例：`user_id`、`job_id`

### 2.3 通用字段（建议每张主表都带）
- `id`：主键
- `created_at`：创建时间
- `updated_at`：更新时间

### 2.4 “统一范式”怎么理解
- **一张表只管一类东西**
  - 用户表只管“用户”，岗位表只管“岗位”。
- **不要把“一个人多个意向城市”硬塞进一个字符串**
  - 用“关联表”来存：一个用户可以对应多条城市记录。
- **可变/很长的内容不要塞主表**
  - 例如简历文件内容不进库，只存文件记录与地址。

---

## 3. 数据库模块与建表清单

> 下文所有表名以 `zt_` 为前缀示例，你们也可以按公司规范替换，但要保持一致。

### 3.1 账号与用户模块（必须）

#### 3.1.1 `zt_user`（用户账号表）
- **这张表存什么**：用户的“账号级”信息
- **核心字段**：
  - `id`
  - `nickname`：昵称
  - `avatar_url`：头像
  - `mobile`：手机号
  - `email`：邮箱
  - `register_at`：注册时间（也可用 `created_at` 代替）

#### 3.1.2 `zt_user_auth_wechat`（微信登录绑定表）
- **这张表存什么**：微信登录需要的绑定信息。
- **核心字段**：
  - `id`
  - `user_id`
  - `openid`
  - `unionid`（如有）

#### 3.1.3 `zt_user_profile`（用户基本资料表）
- **这张表存什么**：前端“基本信息”页面（`profile-edit`）填写的资料。
- **对应前端字段（你们前端真实存在）**：
  - `name`（姓名）
  - `gender`（性别）
  - `degree`（最高学历：本科/硕士/博士）
  - `school`（毕业院校）
  - `major`（专业院系）
  - `grad_year`（毕业年份）
  - `grad_month`（毕业月份）
  - `email`（常用邮箱）
- **核心字段**：
  - `id`
  - `user_id`（与 `zt_user.id` 一对一）
  - 上述资料字段

#### 3.1.4 用户意向（建议用关联表）
> 前端有：意向职位/意向行业/意向城市（`intendedPositions/intendedIndustries/intendedCities`）。

- `zt_user_intended_city_rel`
  - `id`, `user_id`, `city_name`
- `zt_user_intended_industry_rel`
  - `id`, `user_id`, `industry_name`
- `zt_user_intended_position_rel`
  - `id`, `user_id`, `position_name`

**约束建议**：
- 同一用户同一个 `city_name/industry_name/position_name` 不允许重复（唯一约束）。
- 业务上限制最多3个（规则在业务层做）。

---

### 3.2 企业与岗位模块（必须）

#### 3.2.1 `zt_company`（企业表）
- **这张表存什么**：企业基础信息（列表/岗位详情里会展示）。
- **核心字段**：
  - `id`
  - `name`：企业名称
  - `logo_url`：企业logo
  - `industry`：所属行业（主行业）
  - `city`：城市
  - `description`：简介
  - `status`：是否可见/是否已通过审核

#### 3.2.2 `zt_company_tag_rel`（企业标签关联表）
- **这张表存什么**：企业的多个标签
- **核心字段**：
  - `id`, `company_id`, `tag_name`

#### 3.2.3 `zt_job`（岗位表）
- **这张表存什么**：岗位列表、岗位详情、搜索、推荐的“主数据”。
- **核心字段**（对应后端接口 `GET /jobs`、`GET /jobs/{job_id}`、搜索/推荐）：
  - `id`
  - `company_id`
  - `title`：岗位名称
  - `city`
  - `salary_min`、`salary_max`
  - `description`：岗位描述
  - `requirements`：岗位要求
  - `status`：上架/下架/已关闭
  - `publish_time`
- **索引建议**：
  - `company_id`
  - `city`
  - `status`
  - `publish_time`

---

### 3.3 投递模块（必须）

#### 3.3.1 `zt_application`（投递主表）
- **这张表存什么**：用户投递了哪个岗位、当前进度是什么。
- **核心字段**：
  - `id`
  - `user_id`
  - `job_id`
  - `company_id`（冗余字段，方便查询；也可以通过 `job_id` 关联拿到）
  - `resume_id`（关联简历）
  - `status`：投递状态（例如：待投递/投递中/已投递/面试邀请/不合适…）
  - `applied_at`：投递时间
  - `updated_at`
- **约束/索引建议**：
  - `user_id + job_id` 唯一：防止重复投递同一岗位
  - `user_id + status` 索引：我的投递列表按状态筛选更快
  - `company_id + status` 索引：企业端按状态筛选更快

#### 3.3.2 `zt_application_status_history`（投递状态流水表）
- **这张表存什么**：投递状态每一次变化的记录（用于接口里 `timeline`）。
- **核心字段**：
  - `id`
  - `application_id`
  - `from_status`、`to_status`
  - `remark`（备注）
  - `operator_type`：谁改的（用户/企业/系统）
  - `operator_id`
  - `created_at`

#### 3.3.3 `zt_task`（异步任务表，建议）
- **用途**：支持批量投递（接口返回 `task_id`，前端查进度）。
- **核心字段**：
  - `id`
  - `task_type`：如 `batch_apply`
  - `owner_user_id`
  - `status`：`running/success/failed`
  - `progress_total`、`progress_success`、`progress_failed`
  - `result_summary`
  - `created_at`、`updated_at`

---

### 3.4 简历与文件模块（必须）

#### 3.4.1 `zt_file`（文件记录表）
- **对应接口**：`POST /api/v1/files/upload`
- **这张表存什么**：文件元信息（文件本体在对象存储）。
- **核心字段**：
  - `id`（也就是 `file_id`）
  - `biz`：业务类型（例如 `resume`）
  - `owner_user_id`（谁上传的）
  - `name`：原文件名
  - `mime`：文件类型
  - `size`：大小
  - `url`：下载地址
  - `preview_url`：预览地址
  - `hash_md5`：用于去重/校验
  - `created_at`

#### 3.4.2 `zt_resume`（简历表）
- **这张表存什么**：用户“当前使用的简历”。
- **核心字段**：
  - `id`
  - `user_id`
  - `file_id`（关联 `zt_file`）
  - `is_default`：是否默认简历
  - `status`：是否可用
  - `created_at`、`updated_at`

---

### 3.5 收藏模块

#### 3.5.1 `zt_user_favorite_job`（岗位收藏表）
- **这张表存什么**：用户收藏了哪些岗位。
- **核心字段**：
  - `id`
  - `user_id`
  - `job_id`
  - `created_at`
- **约束建议**：`user_id + job_id` 唯一

---

### 3.6 积分模块（必须）

#### 3.6.1 `zt_point_account`（积分账户表）
- **对应接口**：`GET /points/balance`
- **核心字段**：
  - `id`
  - `user_id`
  - `balance`：当前积分余额
  - `updated_at`

#### 3.6.2 `zt_point_ledger`（积分流水表）
- **对应接口**：`GET /points/records`
- **核心字段**：
  - `id`
  - `user_id`
  - `change`：本次变动（+10 / -5）
  - `balance_after`：变动后余额
  - `biz_type`：来源/用途（签到、投递奖励、兑换等）
  - `biz_id`：关联业务ID
  - `created_at`

---

### 3.7 运营CMS模块（必须：轮播图、热门标签）

#### 3.7.1 `zt_cms_banner`（轮播图表）
- **对应接口**：`/admin/banners`
- **核心字段**：
  - `id`
  - `title`
  - `image_url`
  - `jump_url`（点击跳转）
  - `sort`（排序）
  - `status`（上架/下架）
  - `created_at`、`updated_at`

#### 3.7.2 `zt_cms_hot_tag`（热门标签表）
- **对应接口**：`/admin/hot-tags`
- **核心字段**：
  - `id`
  - `tag_name`
  - `tag_type`（行业/职位/搜索热词）
  - `sort`
  - `status`

---

### 3.8 数据报表模块

> 你们有 `metrics/overview`、`funnel`、`retention` 等接口。要做报表，就需要“数据来源”。最简单可落地的方式：先记行为日志，再做按天汇总。

#### 3.8.1 `zt_event_log`（行为日志表，建议）
- **这张表存什么**：关键行为的记录（登录、浏览岗位、搜索、投递等）。
- **核心字段**：
  - `id`
  - `user_id`
  - `event_type`：例如 `login` / `job_view` / `job_search` / `job_apply`
  - `job_id`
  - `keyword`
  - `created_at`

#### 3.8.2 `zt_metrics_daily`（日汇总指标表，建议）
- **这张表存什么**：每天的汇总指标（UV/PV/投递数等）。
- **核心字段**：
  - `id`
  - `stat_date`（日期）
  - `pv`、`uv`
  - `job_apply_cnt`
  - `created_at`、`updated_at`

---

### 3.9（可选）AI 小助手会话历史（前端有 `history` 页面入口）

> 目前前端 `pages/history` 还是占位。若后期要存“聊天记录/问答历史”，可增加以下表。

- `zt_chat_session`
  - `id`, `user_id`, `created_at`
- `zt_chat_message`
  - `id`, `session_id`, `role`（user/bot）, `content`, `created_at`

---

## 4. 关键关联关系

- **一个用户**（`zt_user`）有 **一份基本资料**（`zt_user_profile`）
- **一个用户**可以有 **多个意向城市/行业/职位**（3张关联表）
- **一个企业**（`zt_company`）可以发布 **多个岗位**（`zt_job`）
- **一个用户**可以投递 **多个岗位**（`zt_application`）
- **一次投递**会有 **多条状态变化记录**（`zt_application_status_history`）
- **一个用户**可以上传 **多份文件**（`zt_file`），并有 **多份简历**（`zt_resume`）

---

## 5. 数据安全与隐私

- **手机号/邮箱/姓名等敏感字段**：不建议明文裸奔。
  - 可以要求“MD5加密”，展示时脱敏。
- 你们在后端文档里提到“必要信息需要 MD5”。更通俗的表达可以写成：
  - **需要做唯一校验/去重的字段**：可以存 `hash`（例如 MD5 值）
  - **需要以后还能查看原文的字段**：应该用“可解密”的加密方式（而不是 MD5）

---

## 6. 为了支撑 5000+ 用户 / 200+ 企业的“简单但关键”的数据库要求

- **必须有索引**：
  - 投递：`zt_application(user_id, status)`、`zt_application(company_id, status)`
  - 岗位：`zt_job(city)`、`zt_job(status)`、`zt_job(publish_time)`
- **避免大字段拖慢查询**：岗位详情里的长文本要控制；简历文件不存表里。
- **高频写入**（投递流水/事件日志）建议单独表：`zt_application_status_history`、`zt_event_log`
