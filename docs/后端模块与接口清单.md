# 智通校园（岗位/推荐/投递）后端模块与前端对接接口清单

> 目的：本项目后端**要做哪些模块**、前端（小程序/企业端/运营后台）**要对接哪些接口**。
>
> 说明：
> - 本文**不写如何实现**（具体模块询问AI，要求能同时承接5000+用户以及最少确保200+企业入驻）。
> - 接口路径是建议写法，实际可按团队规范调整。
> - 统一约定：所有接口都需要登录态（除登录/短信验证码等），并且返回统一结构。

---

## 1. 项目概览

这是一个“学生端找岗位 + 智能推荐 + 一键/自动投递 + 企业端招人 + 运营看数据”的系统。

---

## 2. 后端需要哪些模块（按 必须/建议/可选）

### 2.1 必须要做（没有这些系统跑不起来）

#### 2.1.1 网关 / API入口（Gateway）
- **做什么**：所有前端请求先到网关，再转到对应后端服务；统一做日志、限流、鉴权等。
- **你能看到的结果**：前端只有一个域名/入口；接口稳定，出问题能定位。

#### 2.1.2 鉴权中心（登录态：JWT 双Token）
- **做什么**：发放 `access_token`（2小时）和 `refresh_token`（7天）。
- **你能看到的结果**：用户登录后能访问受保护接口；token过期可刷新不用频繁登录。
- **多端策略**：
  - **共存**：同账号允许多设备同时在线

#### 2.1.3 用户服务（C端用户账户 + 用户画像标签 + 积分）
- **做什么**：
  - 微信一键登录（`code2Session`）
  - 用户基础信息（ID、昵称、头像、手机号、学校、专业、毕业年份、意向城市、意向行业、意向职位、积分余额、注册时间）必要的信息需要MD5加密
  - 用户画像标签（用于校招页面推荐岗位）
  - 积分增减与积分流水
- **你能看到的结果**：用户能登录、完善资料、看到积分；推荐会越来越准。

#### 2.1.4 搜索服务（Elasticsearch）
- **做什么**：按“行业/职位/城市/薪资/关键词”等快速从数据库中搜索。
- **你能看到的结果**：搜索快、结果准确。

#### 2.1.5 推荐服务（召回 + 融合 + 精排）
- **做什么**：
  - 多路召回（语义相似/相似用户行为/热门/新发布/直播带岗等）
  - 融合去重
  - 精排（最终排序），保证返回快（目标50ms内）
  - 推荐结果缓存（10分钟）
- **你能看到的结果**：校招页面推荐岗位符合兴趣，加载速度快。

#### 2.1.6 投递服务（投递状态机 + 批量投递 + 投递日志）
- **做什么**：
  - 投递状态流转：待投递、投递中、已投递、面试邀请、不合适等
  - 批量投递（最多50个岗位）：提交后走异步处理，避免卡住
  - 投递日志：记录每次投递的请求/结果/耗时
- **你能看到的结果**：投递进度清晰；批量投递不超时；出了问题能追踪。

#### 2.1.7 运营后台基础能力（CMS + 审计 + 基础报表）
- **做什么**：
  - CMS：轮播图/公告/热门标签/定时发布
  - 审计：谁改了什么
  - 基础报表：UV/PV、投递转化等（哪怕先做最小版）
- **你能看到的结果**：运营能配置内容、看到关键数据。

---

### 2.2 建议要做（强烈建议，能明显提升稳定性与体验）

#### 2.2.1 限流/熔断/降级（网关层）
- **做什么**：
  - 单用户 QPS ≤ 30
  - 单 IP QPS ≤ 100
  - 超出返回 **429**
- **你能看到的结果**：防刷、防被打爆；系统更稳。

#### 2.2.2 配置中心（Nacos/Apollo）
- **做什么**：配置可在线改、热更新，不用重启。
- **你能看到的结果**：运营/研发改配置更方便，故障修复更快。

#### 2.2.3 分布式追踪 + 慢查询告警（SkyWalking/Jaeger）
- **做什么**：每个请求有 traceId，慢请求自动告警。
- **你能看到的结果**：线上问题能快速定位到哪个接口/哪个服务慢。

#### 2.2.4 异步任务（队列）
- **做什么**：批量投递、通知发送、报表生成、回调重试等放到后台异步做。
- **你能看到的结果**：前端接口更快，失败可重试。

#### 2.2.5 消息通知中心（微信订阅消息/服务通知/邮箱）
- **做什么**：按优先级选择通道；失败降级。
- **你能看到的结果**：关键消息能送达。

---

## 3. 通用接口约定（所有端都适用）

### 3.1 统一响应格式（建议）
- **成功**：`{ code: 0, message: "ok", data: ... , traceId: "..." }`
- **失败**：`{ code: 1, message: "错误说明", data: null, traceId: "..." }`

---

## 4. C 端（学生端：微信小程序/移动端）需要对接的接口

> C端主要功能：登录、完善资料、浏览/搜索岗位、看推荐、投递与进度、消息通知、积分。

### 4.1 登录与账户

#### 4.1.1 微信一键登录
- **接口**：`POST /api/v1/auth/wechat/login`
- **用途**：用微信 `code` 换取登录态（token）
- **请求字段**：
  - `code`：微信登录临时码
- **返回字段**：
  - `access_token`
  - `refresh_token`
  - `is_new_user`：是否新用户（用于引导完善资料）
  - `user`：基础信息（id、昵称、头像等）
- **常见错误**：
  - `400`：code无效
  - `500`：微信接口异常

#### 4.1.2 刷新 token
- **接口**：`POST /api/v1/auth/token/refresh`
- **用途**：`access_token` 过期后刷新
- **请求字段**：`refresh_token`
- **返回字段**：新的 `access_token`（必要时也返回新的 `refresh_token`）

#### 4.1.3 退出登录
- **接口**：`POST /api/v1/auth/logout`
- **用途**：注销当前登录态（是否同时让 refresh_token 失效由后端策略决定）

---

### 4.2 用户资料与画像（用于推荐）

#### 4.2.1 获取我的资料
- **接口**：`GET /api/v1/users/me`
- **用途**：个人中心展示
- **返回字段（示例）**：
  - `id`、`nickname`、`avatar`
  - `school`、`major`、`grade`
  - `intention_city`、`intention_salary`、`intention_industry`
  - `points`：当前积分

#### 4.2.2 更新我的资料
- **接口**：`PUT /api/v1/users/me`
- **用途**：完善/修改学校专业、求职偏好等
- **请求字段**（按产品需要选填）：
  - `school`、`major`、`grade`
  - `intention_city`、`intention_salary`、`intention_industry`

---

### 4.3 岗位浏览/详情

#### 4.3.1 岗位列表（最新/热门/筛选）
- **接口**：`GET /api/v1/jobs`
- **用途**：岗位列表页
- **请求参数**（常用）：
  - `page`、`page_size`
  - `city`、`salary_min`、`salary_max`
  - `education`、`internship`（是否实习）等
  - `sort`：`latest`/`hot`
- **返回字段**：
  - `list`：岗位列表（含 `job_id`、标题、地点、薪资、企业名、发布时间等）
  - `total`

#### 4.3.2 岗位详情
- **接口**：`GET /api/v1/jobs/{job_id}`
- **用途**：详情页
- **返回字段**（示例）：
  - `job_id`、`title`、`description`、`requirements`
  - `city`、`salary_range`
  - `company`：企业信息（名称、规模、行业等）
  - `publish_time`、`status`（是否有效/下架）

---

### 4.4 搜索

#### 4.4.1 关键词搜索
- **接口**：`GET /api/v1/search/jobs`
- **用途**：搜索页
- **请求参数**：
  - `q`：关键词
  - `page`、`page_size`
  - 其他筛选同岗位列表
- **返回字段**：同岗位列表

#### 4.4.2 搜索建议（联想词）
- **接口**：`GET /api/v1/search/suggest`
- **用途**：输入框联想
- **请求参数**：`q`
- **返回字段**：`suggestions: []`

---

### 4.5 推荐

#### 4.5.1 首页推荐岗位
- **接口**：`GET /api/v1/recommend/jobs`
- **用途**：推荐流
- **请求参数**：
  - `scene`：场景（例如 `home`）
  - `page`/`cursor`：分页方式二选一
- **返回字段**：
  - `list`：推荐岗位列表
  - `reason`：推荐理由（例如“与你的专业匹配”）

---

### 4.6 投递

#### 4.6.1 单个投递
- **接口**：`POST /api/v1/applications`
- **用途**：对某个岗位发起投递
- **请求字段**：
  - `job_id`
  - `resume_id`（如果有简历管理）或 `resume_snapshot`（投递时固化简历信息）
- **返回字段**：
  - `application_id`
  - `status`：初始状态（如 `applied`/`delivering`）

#### 4.6.2 批量投递（最多50个）
- **接口**：`POST /api/v1/applications/batch`
- **用途**：一次性投多个岗位
- **请求字段**：
  - `job_ids: []`（最多50）
  - `resume_id` / `resume_snapshot`
- **返回字段**：
  - `task_id`：异步任务ID（前端用它查进度）

#### 4.6.3 批量投递进度查询
- **接口**：`GET /api/v1/tasks/{task_id}`
- **用途**：展示“已成功/失败/处理中”的数量
- **返回字段**：
  - `status`：`running`/`success`/`failed`
  - `progress`：例如 `{ total: 50, success: 45, failed: 5 }`
  - `fail_reasons`：失败原因列表

#### 4.6.4 我的投递列表
- **接口**：`GET /api/v1/applications`
- **用途**：投递记录页
- **请求参数**：
  - `status`
  - `page`、`page_size`
- **返回字段**：投递记录（岗位、企业、当前状态、更新时间）

#### 4.6.5 投递详情（含状态流转记录）
- **接口**：`GET /api/v1/applications/{application_id}`
- **用途**：查看当前进度与历史
- **返回字段**：
  - `status`
  - `timeline`：状态变更时间线

---

### 4.8 积分

#### 4.8.1 积分余额
- **接口**：`GET /api/v1/points/balance`
- **用途**：显示当前积分

#### 4.8.2 积分流水
- **接口**：`GET /api/v1/points/records`
- **用途**：显示积分从哪里来、用到哪里去
- **请求参数**：`page`、`page_size`

---

### 5. 投递/简历管理

#### 5.1 查看投递列表
- **接口**：`GET /api/v1/company/applications`
- **用途**：按岗位/状态筛选投递
- **请求参数**：
  - `job_id`（可选）
  - `status`（可选）
  - `page`、`page_size`

#### 5.1 查看投递详情
- **接口**：`GET /api/v1/company/applications/{application_id}`
- **用途**：看简历、投递历史、状态

#### 5.1 更新投递状态（查看/邀面/不合适等）
- **接口**：`POST /api/v1/company/applications/{application_id}/status`
- **用途**：推进招聘流程
- **请求字段**：
  - `status`：`viewed/interview_invited/rejected/offer_sent/offer_accepted`（示例）
  - `remark`（可选）


---

## 6. 运营后台（平台管理端）

> 运营后台主要功能：内容配置、企业/岗位审核（如需要）、数据报表、AB实验（可选）。

### 6.1 CMS 内容管理

#### 6.1.1 轮播图管理
- **接口**：
  - `GET /api/v1/admin/banners`
  - `POST /api/v1/admin/banners`
  - `PUT /api/v1/admin/banners/{id}`
  - `DELETE /api/v1/admin/banners/{id}`
- **用途**：配置首页轮播

#### 6.1.2 热门标签管理
- **接口**：
  - `GET /api/v1/admin/hot-tags`
  - `POST /api/v1/admin/hot-tags`
  - `PUT /api/v1/admin/hot-tags/{id}`
- **用途**：推荐/搜索热词

---

### 6.3 数据报表

#### 6.3.1 核心指标概览
- **接口**：`GET /api/v1/admin/metrics/overview`
- **用途**：展示 UV/PV、投递数、转化率等
- **请求参数**：
  - `date_from`、`date_to`

#### 6.3.2 漏斗分析
- **接口**：`GET /api/v1/admin/metrics/funnel`
- **用途**：例如“浏览岗位 -> 点击投递 -> 投递成功”

#### 6.3.3 留存分析
- **接口**：`GET /api/v1/admin/metrics/retention`
- **用途**：看新用户第N天是否回来

---

## 7. 文件上传

#### 7.1 上传文件
- **接口**：`POST /api/v1/files/upload`
- **用途**：上传简历文件（Word/PDF），用于：
  - C端：投递时选择/更新简历
  - B端：企业查看投递者简历（在线预览/下载）
  - 运营端：审核/排查（如有需要）
- **支持格式**：`.pdf` / `.doc` / `.docx`
- **大小限制**：建议单文件不超过 `10MB`（超出提示用户压缩后再传）
- **请求字段**：
  - `file`：文件本体（表单上传）
  - `biz`：业务场景（可选，示例：`resume`）
- **返回字段**：
  - `file_id`
  - `url`：文件下载地址（需要登录态/鉴权）
  - `preview_url`：在线预览地址（如果系统支持预览）
  - `name`：原文件名
  - `size`：文件大小（字节）
  - `mime`：文件类型
- **常见错误**：
  - `400`：文件为空 / 参数不完整
  - `413`：文件过大
  - `415`：不支持的文件格式
  - `401`：未登录或登录失效

---
