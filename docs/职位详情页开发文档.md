# 职位详情页开发文档

## 📋 功能概述

开发了完整的职位详情页，实现了从公司详情页点击职位卡片跳转到职位详情的功能。

---

## ✅ 已完成的工作

### 1. 修正 API 接口路径

**文件：`utils/api.js`**

**修改前：**
```javascript
function getJobDetail(id) {
  return get(`/job/${id}`);
}
```

**修改后：**
```javascript
function getJobDetail(id) {
  return get(`/job/detail/${id}`);
}
```

**原因：** 后端 Controller 定义的路径是 `/api/job/detail/{id}`，前端需要匹配。

---

### 2. 创建职位详情页

**文件结构：**
```
pages/job-detail/
├── job-detail.js      # 页面逻辑
├── job-detail.wxml    # 页面结构
├── job-detail.wxss    # 页面样式
└── job-detail.json    # 页面配置
```

#### 2.1 页面逻辑 (job-detail.js)

**核心功能：**
- `onLoad(options)`: 获取职位ID并加载数据
- `loadJobDetail(jobId)`: 调用后端接口获取职位详情
- `loadCompanyInfo(companyId)`: 根据职位的公司ID加载公司信息
- `goToCompanyDetail()`: 跳转到公司详情页
- `onChat()`: 立即沟通（暂未实现）
- `onApply()`: 投递简历（暂未实现）

**数据处理：**
- `tags`: 使用 `JSON.parse()` 解析 JSON 字符串为数组
- `salary`: 拼接 `salaryMin` 和 `salaryMax` 为 "30-60K" 格式
- 自动加载关联的公司信息

#### 2.2 页面结构 (job-detail.wxml)

**布局分区：**
1. **顶部导航栏**：返回按钮 + 标题
2. **职位信息卡片**：
   - 职位名称
   - 薪资（高亮显示）
   - 学历/经验/城市标签
3. **公司信息卡片**：
   - 公司Logo
   - 公司名称
   - 行业和规模
   - 可点击跳转到公司详情
4. **职位描述区域**：展示详细描述
5. **技能要求区域**：展示技能标签
6. **底部操作栏**：
   - 立即沟通按钮
   - 投递简历按钮

#### 2.3 页面样式 (job-detail.wxss)

**设计风格：**
- 简洁大气的招聘 APP 风格
- 使用卡片式布局
- 薪资高亮显示（橙色）
- 底部固定操作栏
- 渐变色按钮

**关键样式：**
- 职位薪资：48rpx，橙色 (#ff6a00)
- 技能标签：蓝色主题 (#e8f4ff 背景)
- 底部按钮：渐变蓝色主题

---

### 3. 修改公司详情页跳转逻辑

**文件：`pages/company-detail/company-detail.js`**

**修改前：**
```javascript
goToJobDetail(e) {
  const jobId = e.currentTarget.dataset.id;
  wx.showToast({
    title: `职位ID: ${jobId}`,
    icon: 'none'
  });
}
```

**修改后：**
```javascript
goToJobDetail(e) {
  const jobId = e.currentTarget.dataset.id;
  console.log('点击职位卡片，职位ID:', jobId);
  wx.navigateTo({
    url: `/pages/job-detail/job-detail?id=${jobId}`
  });
}
```

---

### 4. 注册页面路由

**文件：`app.json`**

在 `pages` 数组中添加：
```json
"pages/job-detail/job-detail"
```

---

## 🔗 页面跳转流程

```
校招页 (campus)
    ↓ 点击公司卡片
公司详情页 (company-detail)
    ↓ 点击职位卡片
职位详情页 (job-detail)
    ↓ 点击公司信息
返回公司详情页
```

---

## 📊 数据流程

### 1. 加载职位详情

```javascript
// 请求
GET /api/job/detail/{id}

// 响应
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "companyId": 101,
    "title": "Java高级开发工程师",
    "salaryMin": 30,
    "salaryMax": 60,
    "education": "本科",
    "experience": "3-5年",
    "city": "杭州",
    "tags": "[\"Java\",\"Spring Boot\",\"微服务\"]",
    "description": "负责淘宝核心交易系统..."
  }
}
```

### 2. 数据处理

```javascript
const job = {
  id: jobData.id,
  title: jobData.title,
  salary: `${jobData.salaryMin}-${jobData.salaryMax}K`, // "30-60K"
  education: jobData.education,
  experience: jobData.experience,
  city: jobData.city,
  tags: JSON.parse(jobData.tags || '[]'), // 解析为数组
  description: jobData.description
};
```

### 3. 加载公司信息

```javascript
// 根据 companyId 调用
GET /api/company/detail/{companyId}

// 获取公司名称、Logo、行业、规模等信息
```

---

## 🎨 UI 设计

### 配色方案

| 元素 | 颜色 | 说明 |
|------|------|------|
| 主色调 | #0052d9 | 蓝色，用于按钮和强调 |
| 薪资高亮 | #ff6a00 | 橙色，吸引注意 |
| 标题文字 | #333 | 深灰色 |
| 描述文字 | #666 | 中灰色 |
| 辅助文字 | #999 | 浅灰色 |
| 背景色 | #f5f5f5 | 浅灰背景 |

### 布局特点

- **卡片式设计**：每个区块独立，层次分明
- **固定底部栏**：操作按钮始终可见
- **响应式标签**：自动换行，适应不同内容
- **可点击区域**：公司信息卡片可点击跳转

---

## 🧪 测试步骤

### 1. 准备测试数据

确保后端已执行 SQL 脚本：
```bash
mysql -u root -p
use zhitongxiaoyuan;
source sql/job_module.sql;
```

### 2. 启动后端服务

```bash
mvn spring-boot:run
```

### 3. 测试接口

```bash
# 测试获取职位详情
curl http://localhost:8080/api/job/detail/1
```

### 4. 测试小程序

**测试路径：**
1. 打开小程序开发工具
2. 进入"校招"页面
3. 点击任意公司卡片（如：阿里巴巴）
4. 进入公司详情页
5. 切换到"在招职位"标签
6. 点击任意职位卡片
7. 应该跳转到职位详情页
8. 查看职位信息是否正确显示
9. 点击公司信息卡片，应该返回公司详情页

**预期结果：**
- ✅ 职位标题、薪资、标签正确显示
- ✅ 技能标签正确解析并显示
- ✅ 公司信息正确显示
- ✅ 点击公司卡片可跳转
- ✅ 底部按钮显示正常

---

## 📝 数据示例

### 阿里巴巴 - Java高级开发工程师

```
职位名称：Java高级开发工程师
薪资：30-60K
学历：本科
经验：3-5年
城市：杭州
技能标签：Java, Spring Boot, 微服务, MySQL, Redis
职位描述：负责淘宝核心交易系统的开发与维护，参与高并发场景的架构设计与优化。
```

---

## ⚠️ 注意事项

### 1. API 路径匹配

- 前端：`/job/detail/${id}`
- 后端：`/api/job/detail/{id}`
- 确保路径一致，否则会 404

### 2. JSON 字段解析

- `tags` 字段是 JSON 字符串，必须使用 `JSON.parse()` 解析
- 解析失败时使用空数组作为默认值

### 3. 页面跳转

- 使用 `wx.navigateTo` 而不是 `wx.redirectTo`
- 保留页面栈，用户可以返回

### 4. 错误处理

- 职位ID无效时，提示并返回上一页
- 接口失败时，提示并返回上一页
- 公司信息加载失败不影响职位详情展示

---

## 🚀 后续扩展

### 1. 投递简历功能

```javascript
onApply() {
  // 检查是否登录
  // 选择简历
  // 调用投递接口
  // 提示投递成功
}
```

### 2. 立即沟通功能

```javascript
onChat() {
  // 跳转到聊天页面
  // 或打开客服对话
}
```

### 3. 收藏职位功能

```javascript
onFavorite() {
  // 调用收藏接口
  // 更新收藏状态
}
```

### 4. 分享功能

已实现 `onShareAppMessage`，可以分享职位给好友。

---

## 📌 文件清单

### 新增文件

- `pages/job-detail/job-detail.js`
- `pages/job-detail/job-detail.wxml`
- `pages/job-detail/job-detail.wxss`
- `pages/job-detail/job-detail.json`

### 修改文件

- `utils/api.js` - 修正接口路径
- `pages/company-detail/company-detail.js` - 实现跳转
- `app.json` - 注册页面路由

---

## ✨ 核心特性

1. ✅ 完整的职位详情展示
2. ✅ 自动加载关联公司信息
3. ✅ 正确解析 JSON 字段
4. ✅ 薪资格式化显示
5. ✅ 可点击跳转到公司详情
6. ✅ 简洁大气的 UI 设计
7. ✅ 完善的错误处理
8. ✅ 支持分享功能

---

**开发完成！** 🎉
