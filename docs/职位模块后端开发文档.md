# 职位模块后端开发文档

## 📋 模块概述

职位(Job)模块用于管理招聘职位信息，与公司(Company)模块建立一对多关联关系。一个公司可以发布多个职位。

---

## 🗄️ 数据库设计

### 表结构：job

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| id | BIGINT | 职位ID | 主键，自增 |
| company_id | BIGINT | 公司ID | 必填，关联 company.id |
| title | VARCHAR(100) | 职位名称 | 如"Java开发工程师" |
| salary_min | INT | 最低薪资 | 单位：k |
| salary_max | INT | 最高薪资 | 单位：k |
| education | VARCHAR(50) | 学历要求 | 如"本科" |
| experience | VARCHAR(50) | 经验要求 | 如"3-5年" |
| tags | VARCHAR(500) | 技能标签 | JSON字符串，如`["Java","Spring"]` |
| city | VARCHAR(50) | 工作城市 | 如"杭州" |
| description | TEXT | 职位描述 | 详细描述 |
| created_at | DATETIME | 创建时间 | 自动填充 |
| updated_at | DATETIME | 更新时间 | 自动更新 |
| deleted | TINYINT | 逻辑删除 | 0-未删除，1-已删除 |

### 索引设计

- 主键索引：`id`
- 普通索引：`company_id`（用于按公司查询）
- 普通索引：`city`（用于按城市筛选）
- 普通索引：`deleted`（逻辑删除）

### 建表脚本

执行 `sql/job_module.sql` 创建表并插入种子数据。

---

## 💻 后端代码结构

```
src/main/java/com/example/zhitongxiaoyuan/
├── entity/
│   └── Job.java                    # 职位实体类
├── mapper/
│   └── JobMapper.java              # 职位 Mapper
├── service/
│   ├── JobService.java             # 职位服务接口
│   └── impl/
│       └── JobServiceImpl.java     # 职位服务实现
└── controller/
    └── JobController.java          # 职位控制器
```

---

## 📊 种子数据

已插入 10 条真实招聘职位数据，分布如下：

| 公司 | 公司ID | 职位数量 |
|------|--------|----------|
| 阿里巴巴 | 101 | 3 |
| 腾讯 | 102 | 3 |
| 字节跳动 | 103 | 3 |
| 网易 | 201 | 1 |

**职位示例**：
- Java高级开发工程师（阿里巴巴，30-60k）
- 后端开发工程师-微信方向（腾讯，30-60k）
- 前端开发工程师-抖音（字节跳动，25-50k）

---

## 🔧 API 接口文档

### 1. 获取职位列表

```
GET /api/job/list
```

**请求参数**（可选）：
- `companyId` (Long) - 公司ID，用于筛选指定公司的职位

**响应示例**：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "companyId": 101,
      "title": "Java高级开发工程师",
      "salaryMin": 30,
      "salaryMax": 60,
      "education": "本科",
      "experience": "3-5年",
      "tags": "[\"Java\",\"Spring Boot\",\"微服务\",\"MySQL\",\"Redis\"]",
      "city": "杭州",
      "description": "负责淘宝核心交易系统的开发与维护..."
    }
  ]
}
```

**使用示例**：
```bash
# 获取所有职位
curl http://localhost:8080/api/job/list

# 获取阿里巴巴的职位
curl http://localhost:8080/api/job/list?companyId=101
```

---

### 2. 获取职位详情

```
GET /api/job/detail/{id}
```

**路径参数**：
- `id` (Long) - 职位ID

**响应示例**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "companyId": 101,
    "title": "Java高级开发工程师",
    "salaryMin": 30,
    "salaryMax": 60,
    "education": "本科",
    "experience": "3-5年",
    "tags": "[\"Java\",\"Spring Boot\",\"微服务\",\"MySQL\",\"Redis\"]",
    "city": "杭州",
    "description": "负责淘宝核心交易系统的开发与维护，参与高并发场景的架构设计与优化。"
  }
}
```

**使用示例**：
```bash
curl http://localhost:8080/api/job/detail/1
```

---

## 🔗 与 Company 模块的关联

### 数据库层面

- `job.company_id` 关联 `company.id`
- 外键索引：`idx_company_id`

### 业务层面

**查询公司的所有职位**：
```java
// Service 层
List<Job> jobs = jobService.getJobsByCompanyId(101L);

// Controller 层
GET /api/job/list?companyId=101
```

**前端使用场景**：
1. 在公司详情页展示该公司的所有职位
2. 点击职位卡片跳转到职位详情页

---

## ⚠️ 重要注意事项

### 1. JSON 字段处理

**问题**：`tags` 字段在数据库中存储为 JSON 字符串。

**解决方案**：
- **方案 1（当前实现）**：前端解析
  ```javascript
  const tags = JSON.parse(job.tags);
  ```

- **方案 2**：后端处理（需要创建 DTO）
  ```java
  // 创建 JobDTO.java
  @Data
  public class JobDTO {
      private Long id;
      private String title;
      private List<String> tags; // 解析后的数组
      // ...
  }
  ```

**当前实现**：使用方案 1（前端解析），简单高效。

---

### 2. 薪资字段

- `salaryMin` 和 `salaryMax` 单位为 k（千元）
- 前端显示时需要格式化：`30-60K` 或 `30k-60k`

---

### 3. 逻辑删除

- 使用 `@TableLogic` 注解实现逻辑删除
- 删除操作不会真正删除数据，只是将 `deleted` 字段设置为 1
- 查询时自动过滤已删除的数据

---

## 🧪 测试步骤

### 1. 执行 SQL 脚本

```bash
# 连接 MySQL
mysql -u root -p

# 选择数据库
use zhitongxiaoyuan;

# 执行 SQL 脚本
source sql/job_module.sql;

# 验证数据
SELECT * FROM job;
SELECT COUNT(*) FROM job WHERE company_id = 101;
```

---

### 2. 启动后端服务

```bash
# 启动 Spring Boot 应用
mvn spring-boot:run
```

---

### 3. 测试 API

#### 测试获取所有职位

```bash
curl http://localhost:8080/api/job/list
```

**预期响应**：返回 10 条职位数据。

---

#### 测试按公司筛选

```bash
# 获取阿里巴巴的职位
curl http://localhost:8080/api/job/list?companyId=101
```

**预期响应**：返回 3 条阿里巴巴的职位。

---

#### 测试获取职位详情

```bash
curl http://localhost:8080/api/job/detail/1
```

**预期响应**：返回职位ID为1的详细信息。

---

## 📝 代码规范

### Entity 规范

- 使用 Lombok `@Data` 注解
- 使用 `@TableName` 指定表名
- 使用 `@TableId(type = IdType.AUTO)` 自增主键
- 使用 `@TableLogic` 逻辑删除
- 使用 `@JsonIgnore` 隐藏敏感字段

### Service 规范

- 接口继承 `IService<Job>`
- 实现类继承 `ServiceImpl<JobMapper, Job>`
- 使用 `LambdaQueryWrapper` 构建查询条件
- 方法命名清晰，符合业务语义

### Controller 规范

- 使用 `@RestController` 和 `@RequestMapping`
- 统一返回 `Result<T>` 格式
- 参数使用 `@RequestParam` 或 `@PathVariable`
- 添加详细的注释说明

---

## 🚀 后续扩展

### 1. 职位搜索功能

可以扩展 Service 层添加搜索方法：

```java
/**
 * 搜索职位（支持关键词、城市筛选）
 */
List<Job> searchJobs(String keyword, String city);
```

### 2. 职位统计功能

```java
/**
 * 统计公司的职位数量
 */
Integer countJobsByCompanyId(Long companyId);
```

### 3. 关联查询

可以创建 VO 类，包含公司信息和职位信息：

```java
@Data
public class JobVO {
    private Job job;
    private Company company;
}
```

---

## 📌 总结

### 已完成的工作

1. ✅ 数据库表设计（`job` 表）
2. ✅ 种子数据（10 条职位）
3. ✅ Entity 实体类（Job.java）
4. ✅ Mapper 接口（JobMapper.java）
5. ✅ Service 服务层（JobService.java & JobServiceImpl.java）
6. ✅ Controller 控制器（JobController.java）
7. ✅ API 接口文档

### 接口清单

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 获取职位列表 | GET | /api/job/list | 支持按公司ID筛选 |
| 获取职位详情 | GET | /api/job/detail/{id} | 根据ID获取详情 |

### 核心特性

- ✅ 与 Company 模块建立关联（一对多）
- ✅ 支持按公司ID筛选职位
- ✅ 逻辑删除
- ✅ 自动时间戳
- ✅ JSON 字段存储（tags）

---

**开发完成！** 🎉
