# 公司详情页修复文档

## 修复内容总结

### 1. 清理了 `company-detail.js` 的初始数据
- ✅ 移除了所有硬编码的字节跳动数据
- ✅ 将 `companyInfo` 初始化为空对象结构
- ✅ 将 `businessInfo`, `jobList`, `interviewList` 初始化为空数组

### 2. 优化了 `onLoad` 调试逻辑
- ✅ 添加了详细的 `console.log` 调试信息
- ✅ 打印接收到的参数、ID类型、转换过程
- ✅ 兼容字符串和数字类型的ID（统一转为数字）

### 3. 改进了错误处理
- ✅ 移除了默认显示字节跳动的兜底逻辑
- ✅ 当找不到公司数据时，显示错误提示
- ✅ 自动返回上一页，避免显示空白页面

### 4. 添加了测试入口
- ✅ 在 `index.wxml` 中添加了四个公司的测试跳转链接
- ✅ 添加了美观的测试区域样式

---

## 可用的公司ID列表

| 公司名称 | ID | 跳转链接 |
|---------|-----|---------|
| 阿里巴巴 | 101 | `/pages/company-detail/company-detail?id=101` |
| 腾讯 | 102 | `/pages/company-detail/company-detail?id=102` |
| 字节跳动 | 103 | `/pages/company-detail/company-detail?id=103` |
| 网易 | 201 | `/pages/company-detail/company-detail?id=201` |

---

## 使用方法

### 方法1：使用 navigator 组件（推荐）

```xml
<!-- 在任何 wxml 文件中使用 -->
<navigator url="/pages/company-detail/company-detail?id=101">
  <view>查看阿里巴巴</view>
</navigator>

<navigator url="/pages/company-detail/company-detail?id=102">
  <view>查看腾讯</view>
</navigator>

<navigator url="/pages/company-detail/company-detail?id=103">
  <view>查看字节跳动</view>
</navigator>

<navigator url="/pages/company-detail/company-detail?id=201">
  <view>查看网易</view>
</navigator>
```

### 方法2：使用 wx.navigateTo（在 JS 中）

```javascript
// 在任何页面的 JS 文件中
goToCompanyDetail(companyId) {
  wx.navigateTo({
    url: `/pages/company-detail/company-detail?id=${companyId}`
  });
}

// 使用示例
this.goToCompanyDetail(101); // 跳转到阿里巴巴
this.goToCompanyDetail(102); // 跳转到腾讯
this.goToCompanyDetail(103); // 跳转到字节跳动
this.goToCompanyDetail(201); // 跳转到网易
```

### 方法3：在 campus.js 中使用（已实现）

```javascript
// pages/campus/campus.js
goToCompanyDetail(e) {
  const companyId = e.currentTarget.dataset.id;
  wx.navigateTo({
    url: `/pages/company-detail/company-detail?id=${companyId}`
  });
}
```

```xml
<!-- pages/campus/campus.wxml -->
<view class="company-card"
      bindtap="goToCompanyDetail"
      data-id="{{item.id}}">
  <!-- 公司卡片内容 -->
</view>
```

---

## 调试方法

### 1. 查看控制台日志

打开微信开发者工具的控制台，点击公司卡片后会看到：

```
=== company-detail onLoad ===
接收到的参数: {id: "101"}
原始 ID: 101
ID 类型: string
转换后的 ID: 101
转换后类型: number
=== loadCompanyDetail ===
查找公司 ID: 101
可用的公司 ID: ["101", "102", "103", "201"]
✅ 成功找到公司数据: 阿里巴巴（中国）有限公司
页面数据更新完成
```

### 2. 错误情况

如果传入了不存在的ID（如 999），会看到：

```
=== company-detail onLoad ===
接收到的参数: {id: "999"}
原始 ID: 999
ID 类型: string
转换后的 ID: 999
转换后类型: number
=== loadCompanyDetail ===
查找公司 ID: 999
可用的公司 ID: ["101", "102", "103", "201"]
❌ 未找到ID为 999 的公司数据
可用的公司ID列表: ["101", "102", "103", "201"]
```

同时页面会显示 Toast 提示："未找到公司数据: 999"，并在2秒后自动返回上一页。

---

## 常见问题排查

### Q1: 点击公司卡片后显示错误提示
**原因**：传递的ID与Mock数据中的ID不匹配

**解决方法**：
1. 检查控制台日志，查看"接收到的参数"
2. 确认传递的ID是否在 [101, 102, 103, 201] 中
3. 检查 `campus.js` 中的公司数据，确保 `id` 字段正确

### Q2: 页面显示空白
**原因**：数据未正确加载

**解决方法**：
1. 检查控制台是否有错误日志
2. 确认 `MOCK_COMPANIES` 常量是否正确定义
3. 检查 `loadCompanyDetail` 方法是否被调用

### Q3: 所有公司都显示同一个数据
**原因**：ID传递错误或数据未更新

**解决方法**：
1. 检查 `goToCompanyDetail` 方法中的 `data-id` 绑定
2. 确认 `e.currentTarget.dataset.id` 能正确获取ID
3. 查看控制台日志，确认每次跳转的ID是否不同

---

## 测试清单

- [ ] 在首页点击"阿里巴巴"链接，查看是否显示阿里巴巴的数据
- [ ] 在首页点击"腾讯"链接，查看是否显示腾讯的数据
- [ ] 在首页点击"字节跳动"链接，查看是否显示字节跳动的数据
- [ ] 在首页点击"网易"链接，查看是否显示网易的数据
- [ ] 在校招页面点击公司卡片，查看是否正确跳转
- [ ] 检查控制台日志，确认ID传递正确
- [ ] 测试错误情况（传入不存在的ID），查看错误提示是否正常

---

## 下一步优化建议

1. **添加加载状态**：在数据加载时显示 loading 提示
2. **优化错误处理**：提供更友好的错误页面，而不是直接返回
3. **数据持久化**：将关注状态保存到本地存储
4. **图片优化**：使用真实的公司Logo图片
5. **后端对接**：将Mock数据替换为真实的API接口

---

## 文件修改清单

- ✅ `pages/company-detail/company-detail.js` - 清理初始数据，优化加载逻辑
- ✅ `pages/index/index.wxml` - 添加测试跳转链接
- ✅ `pages/index/index.wxss` - 添加测试区域样式
- ✅ `docs/公司详情页修复文档.md` - 创建本文档
