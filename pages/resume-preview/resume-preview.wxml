<view class="preview-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px;">
    <view class="navbar-content">
      <view class="navbar-left" bindtap="onBack">
        <text class="back-icon">â†</text>
      </view>
      <view class="navbar-title">ç®€å†é¢„è§ˆ</view>
      <view class="navbar-right">
        <text class="edit-btn" bindtap="onEdit">ç¼–è¾‘</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç®€å†å†…å®¹ -->
  <scroll-view wx:else class="resume-scroll" scroll-y>
    <view class="resume-paper">
      <!-- ä¸ªäººä¿¡æ¯å¤´éƒ¨ -->
      <view class="resume-header">
        <view class="header-name">{{resume.name || 'æœªå¡«å†™å§“å'}}</view>
        <view class="header-divider"></view>

        <!-- åŸºæœ¬ä¿¡æ¯è¡Œ -->
        <view class="header-info" wx:if="{{resume.gender || resume.birthDate || resume.phone || resume.email}}">
          <view class="info-item" wx:if="{{resume.gender}}">
            <text class="info-icon">ğŸ‘¤</text>
            <text class="info-text">{{resume.gender}}</text>
          </view>
          <view class="info-item" wx:if="{{resume.birthDate}}">
            <text class="info-icon">ğŸ‚</text>
            <text class="info-text">{{calculateAge(resume.birthDate)}}</text>
          </view>
          <view class="info-item" wx:if="{{resume.phone}}">
            <text class="info-icon">ğŸ“±</text>
            <text class="info-text">{{resume.phone}}</text>
          </view>
          <view class="info-item" wx:if="{{resume.email}}">
            <text class="info-icon">âœ‰ï¸</text>
            <text class="info-text">{{resume.email}}</text>
          </view>
        </view>

        <!-- æ•™è‚²ä¿¡æ¯è¡Œ -->
        <view class="header-info" wx:if="{{resume.education || resume.school || resume.major || resume.graduationDate}}">
          <view class="info-item" wx:if="{{resume.school}}">
            <text class="info-icon">ğŸ«</text>
            <text class="info-text">{{resume.school}}</text>
          </view>
          <view class="info-item" wx:if="{{resume.education}}">
            <text class="info-icon">ğŸ“</text>
            <text class="info-text">{{resume.education}}</text>
          </view>
          <view class="info-item" wx:if="{{resume.major}}">
            <text class="info-icon">ğŸ“š</text>
            <text class="info-text">{{resume.major}}</text>
          </view>
          <view class="info-item" wx:if="{{resume.graduationDate}}">
            <text class="info-icon">ğŸ“…</text>
            <text class="info-text">{{formatDate(resume.graduationDate)}}æ¯•ä¸š</text>
          </view>
        </view>

        <!-- æ±‚èŒæ„å‘è¡Œ -->
        <view class="header-info" wx:if="{{resume.jobIntention || resume.expectedCity || resume.expectedSalary}}">
          <view class="info-item" wx:if="{{resume.jobIntention}}">
            <text class="info-icon">ğŸ’¼</text>
            <text class="info-text">{{resume.jobIntention}}</text>
          </view>
          <view class="info-item" wx:if="{{resume.expectedCity}}">
            <text class="info-icon">ğŸ“</text>
            <text class="info-text">{{resume.expectedCity}}</text>
          </view>
          <view class="info-item" wx:if="{{resume.expectedSalary}}">
            <text class="info-icon">ğŸ’°</text>
            <text class="info-text">{{resume.expectedSalary}}</text>
          </view>
        </view>
      </view>

      <!-- æ•™è‚²ç»å† -->
      <view wx:if="{{educationList.length > 0}}" class="resume-section">
        <view class="section-header">
          <view class="section-icon">ğŸ“</view>
          <view class="section-title">æ•™è‚²ç»å†</view>
          <view class="section-line"></view>
        </view>
        <view class="section-content">
          <view class="timeline-item" wx:for="{{educationList}}" wx:key="id">
            <view class="timeline-dot"></view>
            <view class="timeline-content">
              <view class="item-header">
                <text class="item-title">{{item.school}}</text>
                <text class="item-date">{{item.startDate ? formatDate(item.startDate) : ''}} - {{item.endDate ? formatDate(item.endDate) : ''}}</text>
              </view>
              <view class="item-subtitle">
                <text>{{item.education}}</text>
                <text wx:if="{{item.major}}"> Â· {{item.major}}</text>
              </view>
              <view wx:if="{{item.description}}" class="item-desc">{{item.description}}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- å®ä¹ ç»å† -->
      <view wx:if="{{internshipList.length > 0}}" class="resume-section">
        <view class="section-header">
          <view class="section-icon">ğŸ’¼</view>
          <view class="section-title">å®ä¹ ç»å†</view>
          <view class="section-line"></view>
        </view>
        <view class="section-content">
          <view class="timeline-item" wx:for="{{internshipList}}" wx:key="id">
            <view class="timeline-dot"></view>
            <view class="timeline-content">
              <view class="item-header">
                <text class="item-title">{{item.company}}</text>
                <text class="item-date">{{item.startDate ? formatDate(item.startDate) : ''}} - {{item.endDate ? formatDate(item.endDate) : ''}}</text>
              </view>
              <view class="item-subtitle">{{item.position}}</view>
              <view wx:if="{{item.description}}" class="item-desc">{{item.description}}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- é¡¹ç›®ç»å† -->
      <view wx:if="{{projectList.length > 0}}" class="resume-section">
        <view class="section-header">
          <view class="section-icon">ğŸš€</view>
          <view class="section-title">é¡¹ç›®ç»å†</view>
          <view class="section-line"></view>
        </view>
        <view class="section-content">
          <view class="timeline-item" wx:for="{{projectList}}" wx:key="id">
            <view class="timeline-dot"></view>
            <view class="timeline-content">
              <view class="item-header">
                <text class="item-title">{{item.name}}</text>
                <text class="item-date">{{item.startDate ? formatDate(item.startDate) : ''}} - {{item.endDate ? formatDate(item.endDate) : ''}}</text>
              </view>
              <view class="item-subtitle">{{item.role}}</view>
              <view wx:if="{{item.description}}" class="item-desc">{{item.description}}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- è·å¥–ç»å† -->
      <view wx:if="{{awardList.length > 0}}" class="resume-section">
        <view class="section-header">
          <view class="section-icon">ğŸ†</view>
          <view class="section-title">è·å¥–ç»å†</view>
          <view class="section-line"></view>
        </view>
        <view class="section-content">
          <view class="timeline-item" wx:for="{{awardList}}" wx:key="id">
            <view class="timeline-dot"></view>
            <view class="timeline-content">
              <view class="item-header">
                <text class="item-title">{{item.name}}</text>
                <text class="item-date">{{item.awardDate ? formatDate(item.awardDate) : ''}}</text>
              </view>
              <view class="item-subtitle" wx:if="{{item.level}}">{{item.level}}</view>
              <view wx:if="{{item.description}}" class="item-desc">{{item.description}}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- è‡ªæˆ‘è¯„ä»· -->
      <view wx:if="{{resume.selfEvaluation}}" class="resume-section">
        <view class="section-header">
          <view class="section-icon">âœ¨</view>
          <view class="section-title">è‡ªæˆ‘è¯„ä»·</view>
          <view class="section-line"></view>
        </view>
        <view class="section-content">
          <view class="text-content">{{resume.selfEvaluation}}</view>
        </view>
      </view>

      <!-- æŠ€èƒ½ç‰¹é•¿ -->
      <view wx:if="{{resume.skills}}" class="resume-section">
        <view class="section-header">
          <view class="section-icon">âš¡</view>
          <view class="section-title">æŠ€èƒ½ç‰¹é•¿</view>
          <view class="section-line"></view>
        </view>
        <view class="section-content">
          <view class="text-content">{{resume.skills}}</view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€æç¤º -->
      <view wx:if="{{!hasContent}}" class="empty-state">
        <text class="empty-icon">ğŸ“„</text>
        <text class="empty-text">ç®€å†å†…å®¹ä¸ºç©º</text>
        <text class="empty-hint">è¯·å…ˆç¼–è¾‘ç®€å†å†…å®¹</text>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-bottom"></view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions" style="padding-bottom: calc(24rpx + {{safeAreaBottom}}px);">
    <button class="action-btn secondary" bindtap="onShare">
      <text class="btn-icon">ğŸ“¤</text>
      <text>åˆ†äº«</text>
    </button>
    <button class="action-btn primary" bindtap="onExport">
      <text class="btn-icon">ğŸ“¥</text>
      <text>å¯¼å‡ºPDF</text>
    </button>
  </view>
</view>
